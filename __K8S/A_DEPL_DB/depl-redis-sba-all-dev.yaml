################~~~~ Redis SBA Hierarchy ~~~~~##################
#### Run Command
## BASH
# kubectl apply -f ./__K8S/A_DEPL_DB/depl-redis-sba-all-dev.yaml
# kubectl delete -f ./__K8S/A_DEPL_DB/depl-redis-sba-all-dev.yaml
# kubectl rollout restart deployments depl-redis-sba-all-dev

## Connect
# redis-cli -h 127.0.0.1 -p 6379 -a 'P@55w0rd!123'

#### (3) Redis Claim (Hierarchy) 

# - This Task Done Only Once
# - Creating Claim for Redis
# kubectl get pvc
# kubectl get pvc claim-redis-sba-all-dev
# kubectl delete pvc claim-redis-sba-all-dev
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: claim-redis-sba-all-dev
spec:
  resources:
    requests:
      storage: 500Mi
  accessModes:
  - ReadWriteOnce

---

#### (3) Redis Deployment (Hierarchy) 
# - kubectl get deployment
# - kubectl get deployment depl-redis-sba-all-dev
# - kubectl delete deployment depl-redis-sba-all-dev
apiVersion: apps/v1
kind: Deployment
metadata:
  name: depl-redis-sba-all-dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: redis-sba-all-dev
  template:
    metadata:
      labels:
        app: redis-sba-all-dev
    spec:
      containers:
        - name: redis
          image: redis:latest
          args: ["redis-server", "--requirepass", "P@55w0rd!123"]
          ports:
            - containerPort: 6379
          resources:
            limits:
              memory: 512Mi
              cpu: "500m"
            requests:
              memory: 256Mi
              cpu: "250m"
          volumeMounts:
            - mountPath: /data
              name: redisdb
      volumes:
        - name: redisdb
          persistentVolumeClaim:
            claimName: claim-redis-sba-all-dev

---

#------------------------------------------------------------------------- 
#### (4) Redis ClusterIP (Hierarchy)
# - We need ClusterIP for Inter Service Communication
# - Production Required
# - kubectl get svc
# - kubectl get svc srvc-cip-redis-sba-all-dev
apiVersion: v1
kind: Service
metadata:
  name: srvc-cip-redis-sba-all-dev
spec:
  type: ClusterIP
  selector:
    app: redis-sba-all-dev
  ports:
    - name: redis
      protocol: TCP
      port: 6379 # Port -> Cluster 
      targetPort: 6379 # Port -> (Pod / Container)

---

#-------------------------------------------------------------------------
#### (6) Redis LoadBalancer (Hierarchy)
# - We need LoadBalancer for External Service Access
# - No Production Required
# - kubectl get svc srvc-loadbalancer-redis-sba-all-dev
## Credentials for LoadBalancer
# - 127.0.0.1,6379 'P@55w0rd!123'
apiVersion: v1
kind: Service
metadata:
  name: srvc-loadbalancer-redis-sba-all-dev
spec:
  type: LoadBalancer
  selector:
    app: redis-sba-all-dev
  ports:
    - protocol: TCP
      port: 6379
      targetPort: 6379
